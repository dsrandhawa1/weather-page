<!-- style="border: 2px solid black"-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Novi MI Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin:0;
  height:100%;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:white;
}
.container{
  display:flex;
  flex-direction:column;
  height:100%;
  padding:1px;
  box-sizing:border-box;
}
.card{
  background:#ededed;
  border-radius:18px;
  padding:5px;
  box-shadow:0 4px 12px rgba(0,0,0,.1);
  margin-bottom:12px;
}
.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.city{
  font-size:2.5rem;
  font-weight:600;
}
.clock-wrap{
  text-align:right;
}
.date{font-size:2rem;}
.clock{font-size:3.6rem;}
.current{
  display:flex;
  align-items:center;
  gap:24px;
  margin-top:16px;
}
.icon{font-size:4.5rem;}
.temp{font-size:8rem;font-weight:600;}
.hilo{font-size:2.2rem;opacity:.7;}
.travel{
  margin-top:8px;
  font-size:1.15rem;
  color:#1a73e8;
}
.section{
  margin-top:16px;
}
.section-title{
  font-size:1.6rem;
  margin-bottom:8px;
}
.hourly,.daily{
  display:flex;
  justify-content:space-between;
}
.hour,.day{
  text-align:center;
  font-size:1.3rem;
}
.day-date{font-weight:600;}
.updated{
  margin-top:12px;
  display:flex;
  gap:16px;
  flex-wrap:wrap;
  font-size:1rem;
  opacity:.7;
}
.quote{font-style:italic;}
footer{
  margin-top:auto;
  text-align:center;
  opacity:.5;
}
</style>
</head>

<body>
<div style="border: 2px solid black"class="container">

<div style="border: 2px solid black"class="card section">
<table width="100%">
<tr>
<td width=5%><div style="border: 2px solid black"class="icon" id="icon">‚òÄÔ∏è</div></td>
<td width=5%><div style="border: 2px solid black"class="temp" id="temp">--¬∞</div></td>

<td width=5%>
<div style="border: 2px solid black"class="hilo">
<table width="100%">
<tr><td align="right">High1:</td><td align="left"><span id="high">--¬∞</span></td></tr>
<tr><td align="right">Low:</td><td align="left"><span id="low">--¬∞</span></td></tr>
</table>
</div>
</td>


<td width="50%">
<div style="border: 2px solid black"class="clock-wrap">
<div style="border: 2px solid black"class="date" id="date"></div>
<div style="border: 2px solid black"class="clock" id="clock"></div>
</div>
</td>
</tr>
</table>
<div style="border: 2px solid black"class="updated"><span id="updated"></span></div>
</div>

<div style="border: 2px solid black"class="card section">
<div style="border: 2px solid black"class="section-title">Next 12 Hours</div>
<div style="border: 2px solid black"class="hourly" id="hourly"></div>
</div>

<div style="border: 2px solid black"class="card section">
<div style="border: 2px solid black"class="section-title">8-Day Forecast</div>
<div style="border: 2px solid black"class="daily" id="daily"></div>
</div>
<div style="border: 2px solid black"class="travel" id="travel"></div>
</div>

<script>
const LAT = 42.4806;
const LON = -83.4755;

/* ELEMENT LOOKUPS (Safari-safe) */
const el = id => document.getElementById(id);

/* CLOCK */
function updateClock(){
  const now = new Date();
  el("date").textContent = now.toLocaleDateString([], {
    weekday:"long", month:"long", day:"numeric", year:"numeric"
  });
  el("clock").textContent = now.toLocaleTimeString([], {
    hour:"numeric", minute:"2-digit"
  });
}
setInterval(updateClock, 1000);
updateClock();

/* ICONS */
function weatherIcon(code){
  if(code < 3) return "‚òÄÔ∏è";
  if(code < 50) return "‚õÖ";
  if(code < 70) return "üåßÔ∏è";
  if(code < 80) return "‚ùÑÔ∏è";
  return "üå©Ô∏è";
}

function precipIcon(code){
  if ((code >= 71 && code <= 77) || code === 85 || code === 86) return "‚ùÑÔ∏è";
  if ((code >= 51 && code <= 67) || (code >= 80 && code <= 82)) return "üåßÔ∏è";
  return "";
}

/* WEATHER */
async function loadWeather(){
  const url =
    "https://api.open-meteo.com/v1/forecast" +
    "?latitude=" + LAT +
    "&longitude=" + LON +
    "&current_weather=true" +
    "&hourly=temperature_2m,weathercode,precipitation_probability" +
    "&daily=temperature_2m_max,temperature_2m_min,weathercode,precipitation_probability_max" +
    "&temperature_unit=fahrenheit&timezone=auto";

  const d = await (await fetch(url)).json();

  el("temp").textContent = Math.round(d.current_weather.temperature) + "¬∞";
  el("icon").textContent = weatherIcon(d.current_weather.weathercode);
  el("high").textContent = Math.round(d.daily.temperature_2m_max[0]) + "¬∞";
  el("low").textContent = Math.round(d.daily.temperature_2m_min[0]) + "¬∞";

  const hourly = el("hourly");
  hourly.innerHTML = "";
  let shown = 0;
  const now = new Date();

  for (let i = 0; i < d.hourly.time.length && shown < 12; i++) {
    const t = new Date(d.hourly.time[i]);
    if (t > now) {
      const precip = d.hourly.precipitation_probability[i];
      const pIcon = precipIcon(d.hourly.weathercode[i]);

      hourly.innerHTML +=
        '<div style="border: 2px solid black"class="hour">' +
          '<div>' + t.toLocaleTimeString([], {hour:"numeric"}) + '</div>' +
          '<div>' + weatherIcon(d.hourly.weathercode[i]) + '</div>' +
          '<div>' + Math.round(d.hourly.temperature_2m[i]) + '¬∞</div>' +
          '<div style="border: 2px solid black"style="font-size:.9em;opacity:.7">' +
            (pIcon && precip != null ? precip + "% " + pIcon : "") +
          '</div>' +
        '</div>';
      shown++;
    }
  }

  const daily = el("daily");
  daily.innerHTML = "";

  for (let i = 1; i < d.daily.time.length; i++) {
    const parts = d.daily.time[i].split("-");
    const dt = new Date(parts[0], parts[1] - 1, parts[2]);
    const precip = d.daily.precipitation_probability_max[i];
    const pIcon = precipIcon(d.daily.weathercode[i]);

    daily.innerHTML +=
      '<div style="border: 2px solid black"class="day">' +
        '<div style="border: 2px solid black"class="day-date">' +
          dt.toLocaleDateString([], {weekday:"short", month:"numeric", day:"numeric"}) +
        '</div>' +
        '<div>' + weatherIcon(d.daily.weathercode[i]) + '</div>' +
        '<div>' +
          Math.round(d.daily.temperature_2m_max[i]) + '¬∞ / ' +
          Math.round(d.daily.temperature_2m_min[i]) + '¬∞' +
        '</div>' +
        '<div style="border: 2px solid black"style="font-size:.9em;opacity:.7">' +
          (pIcon && precip != null ? precip + "% " + pIcon : "") +
        '</div>' +
      '</div>';
  }

  el("updated").textContent =
    "Last updated: " +
    new Date().toLocaleTimeString([], {hour:"numeric", minute:"2-digit"});
}

loadWeather();
setInterval(loadWeather, 300000);

/* TRAVEL */
const mapboxKey = "pk.eyJ1Ijoic3Rncm91cCIsImEiOiJjbWp4ZXE1cmE1a3VyM2dxMWVma2tkempzIn0.w225FCxMloOE30u-aghOmw";
const origin = [-83.4755,42.4806];
const destination = [-83.2205,42.5536];

async function loadTravelTime(){
  const hour = new Date().getHours();
  if (hour >= 6 && hour < 8) {
    try {
      const r = await fetch(
        "https://api.mapbox.com/directions/v5/mapbox/driving/" +
        origin.join(",") + ";" + destination.join(",") +
        "?access_token=" + mapboxKey
      );
      const d = await r.json();
      el("travel").textContent =
        "üöó Estimated drive: ~" + Math.round(d.routes[0].duration / 60) + " min";
    } catch {
      el("travel").textContent = "üöó Travel time unavailable";
    }
  } else {
    el("travel").textContent =
      "üöó Travel time to Avleen school will be displayed only between 6 AM and 8 AM";
  }
}
loadTravelTime();
setInterval(loadTravelTime, 600000);
</script>
</body>
</html>
