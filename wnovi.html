<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Weather ‚Äì Novi, MI</title>

<style>
:root {
    --bg: #f8f9fa;
    --card: #ffffff;
    --text: #202124;
    --sub: #5f6368;
}

html, body {
    margin: 0;
    height: 100%;
    width: 100%;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg);
    color: var(--text);
}

body {
    display: flex;
    flex-direction: column;
    width: 100vw;
    height: 100vh;
}

.container {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    width: 100vw;
    height: 100%;
    padding: 14px;
    box-sizing: border-box;
}

/* Cards */
.card {
    position: relative;
    background: var(--card);
    border-radius: 20px;
    padding: 14px 18px;
    box-shadow: 0 4px 20px rgba(0,0,0,.06);
    margin-bottom: 14px;
    flex-shrink: 0;
}

/* CURRENT WEATHER */
.current-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.current-left {
    display: flex;
    align-items: center;
    gap: 40px;
}

/* Fonts */
.city {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 4px;
}

.current-temp {
    font-size: 4.2rem;
    font-weight: 600;
    line-height: 1.2;
}

.condition {
    font-size: 3rem;
    margin: 6px 0;
}

/* High/Low vertical */
.hilo-vertical {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: flex-start;
}

.hilo-vertical div {
    font-size: 2.4rem;
    font-weight: 600;
}

.hilo-vertical div span.label {
    font-size: 1.44rem; /* 40% smaller label */
    font-weight: 500;
}

/* Last updated */
.updated {
    font-size: .95rem;
    color: var(--sub);
    margin-top: 3px;
}

.updated.stale {
    color: #d93025;
}

/* CLOCK */
.clock-container {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    position: absolute;
    top: 8px;
    right: 16px;
}

.clock {
    font-size: 4rem;
    font-weight: 600;
    line-height: 1;
    color: var(--text);
    pointer-events: none;
}

.toggle-seconds {
    margin-top: 4px;
    font-size: 1rem;
    padding: 3px 6px;
    border-radius: 6px;
    border: 1px solid #ccc;
    background: #f1f3f4;
    cursor: pointer;
}

/* Hourly forecast (Next 12 hours) */
.hourly {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 5px;
    text-align: center;
    font-size: 1.36rem;
}

.hour {
    background: #f1f3f4;
    border-radius: 12px;
    padding: 9px 4px;
}

.hour .icon {
    font-size: 2.56rem;
    margin: 2px 0;
}

/* Daily forecast (7 days) */
.daily {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 9px;
    text-align: center;
    font-size: 1.44rem;
}

.day {
    background: #f1f3f4;
    border-radius: 14px;
    padding: 14px 9px;
}

.day .icon {
    font-size: 2.56rem;
}

/* Footer */
.footer {
    text-align: center;
    margin-top: 8px;
    font-size: 0.85rem;
    color: var(--sub);
    flex-shrink: 0;
}
</style>
</head>

<body>
<div class="container">

<!-- CURRENT WEATHER -->
<div class="card">
    <div class="current-header">
        <div class="current-left">
            <div>
                <div class="city">Novi, MI</div>
                <div class="current-temp" id="currentTemp">--¬∞</div>
                <div class="condition" id="condition">‚òÄÔ∏è</div>
                <div class="updated" id="updated">Updating‚Ä¶</div>
            </div>
            <div class="hilo-vertical">
                <div><span class="label">High</span> <span id="todayHigh">--¬∞</span></div>
                <div><span class="label">Low</span> <span id="todayLow">--¬∞</span></div>
            </div>
        </div>
        <div class="clock-container">
            <div class="clock" id="clock">--:--:--</div>
            <button class="toggle-seconds" id="toggleSecondsBtn">Hide Seconds</button>
        </div>
    </div>
</div>

<!-- HOURLY FORECAST -->
<div class="card">
    <h3 style="margin:4px 0; font-size:1.6rem;">Next 12 Hours</h3>
    <div class="hourly" id="hourly"></div>
</div>

<!-- DAILY FORECAST -->
<div class="card">
    <h3 style="margin:4px 0; font-size:1.6rem;">7-Day Forecast</h3>
    <div class="daily" id="daily"></div>
</div>

<!-- Footer -->
<div class="footer">Powered by Dipu Singh</div>

</div>

<script>
const LAT = 42.4668;   // Novi, MI latitude
const LON = -83.4875;  // Novi, MI longitude
const REFRESH_MS = 5 * 60 * 1000;

const icons = {
    0:"‚òÄÔ∏è",1:"üå§Ô∏è",2:"‚õÖ",3:"‚òÅÔ∏è",
    45:"üå´Ô∏è",48:"üå´Ô∏è",
    51:"üå¶Ô∏è",53:"üå¶Ô∏è",55:"üå¶Ô∏è",
    61:"üåßÔ∏è",63:"üåßÔ∏è",65:"üåßÔ∏è",
    71:"‚ùÑÔ∏è",73:"‚ùÑÔ∏è",75:"‚ùÑÔ∏è",
    95:"‚õàÔ∏è"
};

function icon(code){ return icons[code] || "üå°Ô∏è"; }

function showUpdating(){
    const el = document.getElementById("updated");
    el.textContent = "Updating‚Ä¶";
    el.classList.remove("stale");
}

function updateTimestamp(){
    const lastUpdate = new Date();
    const el = document.getElementById("updated");
    el.textContent = "Last updated: " +
        lastUpdate.toLocaleString([],{
            weekday:"short",
            hour:"numeric",
            minute:"2-digit",
            hour12:true
        });
}

function markStale(){
    const el = document.getElementById("updated");
    el.textContent = "‚ö† Weather data may be out of date";
    el.classList.add("stale");
}

// CLOCK
let showSeconds = true;
const clockEl = document.getElementById("clock");
const toggleBtn = document.getElementById("toggleSecondsBtn");

function updateClock(){
    const now = new Date();
    clockEl.textContent = now.toLocaleTimeString([], {
        hour:'2-digit', 
        minute:'2-digit', 
        second: showSeconds ? '2-digit' : undefined,
        hour12:true
    });
}
setInterval(updateClock, 1000);
updateClock();

toggleBtn.addEventListener("click", ()=>{
    showSeconds = !showSeconds;
    toggleBtn.textContent = showSeconds ? "Hide Seconds" : "Show Seconds";
    updateClock();
});

async function loadWeather(){
    showUpdating();
    const tempEl = document.getElementById("currentTemp");
    tempEl.classList.add("fade");

    try {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true&hourly=temperature_2m,weathercode,windspeed_10m&daily=temperature_2m_max,temperature_2m_min,weathercode&temperature_unit=fahrenheit&windspeed_unit=mph&timezone=auto`;
        const res = await fetch(url);
        if(!res.ok) throw new Error();
        const d = await res.json();

        document.getElementById("currentTemp").textContent = Math.round(d.current_weather.temperature) + "¬∞";
        document.getElementById("condition").textContent = icon(d.current_weather.weathercode);
        document.getElementById("todayHigh").textContent = Math.round(d.daily.temperature_2m_max[0]) + "¬∞";
        document.getElementById("todayLow").textContent = Math.round(d.daily.temperature_2m_min[0]) + "¬∞";

        // Hourly next 12 hours
        const h = document.getElementById("hourly");
        h.innerHTML = "";
        const now = new Date();
        const currentHourIndex = d.hourly.time.findIndex(t => new Date(t) >= now);
        for(let i=currentHourIndex; i<currentHourIndex+12 && i<d.hourly.time.length; i++){
            const time = new Date(d.hourly.time[i]);
            h.innerHTML += `
                <div class="hour">
                    <div>${time.toLocaleString([], {hour:'numeric', hour12:true})}</div>
                    <div class="icon">${icon(d.hourly.weathercode[i])}</div>
                    <div>${Math.round(d.hourly.temperature_2m[i])}¬∞</div>
                </div>`;
        }

        // Daily 7 days
        const day = document.getElementById("daily");
        day.innerHTML = "";
        for(let i=0;i<7;i++){
            const date = new Date(d.daily.time[i]);
            day.innerHTML += `
                <div class="day">
                    <div>${date.toLocaleDateString([], {weekday:"short"})}</div>
                    <div class="icon">${icon(d.daily.weathercode[i])}</div>
                    <div>${Math.round(d.daily.temperature_2m_max[i])}¬∞ /
                         ${Math.round(d.daily.temperature_2m_min[i])}¬∞</div>
                </div>`;
        }

        updateTimestamp();
        setTimeout(()=>tempEl.classList.remove("fade"),200);
    } catch {
        markStale();
    }
}

loadWeather();
setInterval(loadWeather, REFRESH_MS);
document.addEventListener("visibilitychange", ()=>{ if(!document.hidden) loadWeather(); });
</script>
</body>
</html>
